[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Device",
  "modified": "2021-03-26 14:54:37.047546",
  "name": "Device-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Device', {\n  setup (frm) {\n    frm.set_query(\"detected_by\", function() {\n      return {\n       filters: [\n         [\"Device\",\"is_scanner\", \"=\", 1]\n       ]\n      };\n    });  \n  },    \n  onload(frm) {\n    // your code here\n    show_image(frm);\n  },\n  refresh(frm) {\n    //var map = frm.get_field(\"location\").map;\n    //var latlng = L.latLng({'lat': 43.537621, 'lng': -5.659692});\n    //var marker = L.marker(latlng);\n    //map.flyTo(latlng, map.getZoom());\n    //marker.addTo(map);\n    //marker.bindPopup(frm.doc.name).openPopup();  \n  },\n  media_library (frm) {\n    show_image(frm);  \n  },\n  is_located (frm) {\n    if (frm.doc.is_located === 0) {\n      frm.doc.rssi = null;\n      frm.doc.training_place = null;\n      frm.doc.detected_by = null;\n    }      \n  }\n});\nfunction show_image (frm) {\n  if (frm.doc.media_library) {\n    frappe.call({\n      method: 'atvirtual.atvirtual.custom.get_image',\n        args: {\n\t      slide: frm.doc.media_library\n        },\n        callback: (r) => {\n          //console.log(r.message);\n          if (r.message.length >0) {\n            var rtemplate = \"\";\n            console.log(r.message);\n            for (var j in r.message) {\n              //rtemplate += '<a href=\"' + r.message[j].image + '\" target=\"_blank\"><img style=\"border: 1px solid #4682b4; float: left; margin: 1px; padding: 1px;\" height=\"120px\" src=\"' + r.message[j].image + '\" /></a>';  \n              rtemplate += '<div class=\"card\"><a class=\"card-text\" href=\"' + r.message[j].image + '\" target=\"_blank\"><img style=\"border: 1px solid #4682b4; border-radius: 9px; float: left; margin: 1px; padding: 1px;\" height=\"120px\" title=\"' + r.message[j].heading + '\" src=\"' + r.message[j].image + '\" /></a></div>'; \n            }\n            //var template = '<div class=\"container-fluid\"><h4>' + frm.doc.media_library + '</h4>' + rtemplate + '</div>';\n            var template = '<div class=\"container-fluid\"><h4>' + frm.doc.media_library + '</h4><div class=\"card-columns\">' + rtemplate + '</div></div>';\n            //console.log(template);\n            frm.set_df_property('html_image', 'options', frappe.render_template(template));\n            frm.refresh_field('html_image');\n          }\n        }\n    });    \n  } else {\n    //console.log(frm.doc.media_library);\n    var noimage = '<div class=\"container-fluid\"><h4>No Image Gallery</h4></div>';\n    frm.set_df_property('html_image', 'options', frappe.render_template(noimage));\n    frm.refresh_field('html_image');\n  }\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Training Course",
  "modified": "2021-07-09 19:35:44.920264",
  "name": "Training Course-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Training Course', {\n    setup(frm) {\n      //frm.set_query(\"device\", \"items\", function() {\n        //return {\n        //  \"filters\": [[\"Device\", \"is_scanner\", \"=\", 1]]\n        //};\n      //});\n       frm.fields_dict['action_messages'].grid.get_field('sch_message').get_query = function(doc, cdt, cdn) {\n\t\t//var child = locals[cdt][cdn];\n\t\t//console.log(child);\n\t\treturn {\t\n\t\t  filters:[\n\t\t    ['docstatus', '=', 0]\n\t\t  ]\n\t\t};\n\t  };\n      frm.fields_dict['action_messages'].grid.get_field('scanner').get_query = function(doc, cdt, cdn) {\n\t\t//var child = locals[cdt][cdn];\n\t\t//console.log(child);\n\t\treturn {\t\n\t\t  filters:[\n\t\t    ['is_scanner', '=', 1]\n\t\t  ]\n\t\t};\n\t  };\n\t  frm.fields_dict['action_messages'].grid.get_field('located').get_query = function(doc, cdt, cdn) {\n\t\t//var child = locals[cdt][cdn];\n\t\t//console.log(child);\n\t\treturn {\t\n\t\t  filters:[\n\t\t    ['is_scanner', '=', 0], ['is_atvirtual', '=', 1]\n\t\t  ]\n\t\t};\n\t  };\n\t  frm.fields_dict['action_messages'].grid.get_field('ordered').get_query = function(doc, cdt, cdn) {\n\t\t//var child = locals[cdt][cdn];\n\t\t//console.log(child);\n\t\treturn {\t\n\t\t  filters:[\n\t\t    ['is_scanner', '=', 0], ['is_atvirtual', '=', 1]\n\t\t  ]\n\t\t};\n\t  };\n      frm.fields_dict['items'].grid.get_field('device').get_query = function(doc, cdt, cdn) {\n\t\t//var child = locals[cdt][cdn];\n\t\t//console.log(child);\n\t\treturn {\t\n\t\t  filters:[\n\t\t    ['is_scanner', '=', 1]\n\t\t  ]\n\t\t};\n\t  };\n\t  frm.fields_dict['participants'].grid.get_field('participant_role').get_query = function(doc, cdt, cdn) {\n\t\t//var child = locals[cdt][cdn];\n\t\t//console.log(child);\n\t\treturn {\t\n\t\t  filters:[\n\t\t    ['is_group', '=', 0], ['session_type', '=', frm.doc.training_type]\n\t\t  ]\n\t\t};\n\t  };\n\t  frm.fields_dict['sch_messages'].grid.get_field('sch_message').get_query = function(doc, cdt, cdn) {\n\t\t//var child = locals[cdt][cdn];\n\t\t//console.log(child);\n\t\treturn {\t\n\t\t  filters:[\n\t\t    ['docstatus', '=', 0]\n\t\t  ]\n\t\t};\n\t  };\n    },\n    onload(frm) {\n\t  // your code here\n\t  var template = '';\n\t  if (frm.doc.route && frm.doc.published) {\n\t    template = '<h4><a style=\"color: #4682b4; font-size: 10pt;\" href=\"' + frm.doc.route + '\">' + frm.doc.title + '</a></h4>';\n\t    frm.set_df_property('html_route', 'options', frappe.render_template(template));\n        frm.refresh_field('html_route');\n\t  }\n\t},\n\trefresh (frm) {\n\t  //frm.add_custom_button(__(\"to Training Session\"), function() {\n      //  frappe.msgprint(\"Here the code for Groupal Message\");\n      //}, __(\"iMessages\"));\n      var template = '';\n\t  if (frm.doc.route && frm.doc.published && !frm.doc.__islocal) {\n\t    template = '<h4><a style=\"color: #4682b4; font-size: 10pt;\" href=\"' + frm.doc.route + '\">' + frm.doc.title + '</a></h4>';\n\t    frm.set_df_property('html_route', 'options', frappe.render_template(template));\n        frm.refresh_field('html_route');\n\t  }\n\t}\n});\nfrappe.ui.form.on(\"Destination Item\",{\n  send_now: function(frm, cdt, cdn){\n\tvar d = locals[cdt][cdn];\n\tfrappe.msgprint(\"Message \" + d.sch_message);\n\tvar msg = d.sch_message;\n\tfrappe.call({\n      method: 'atvirtual.atvirtual.custom.submit_pibimessage',\n      args: {\n        doc: msg\n      }\n    });\n  }\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "pibiMessage",
  "modified": "2021-07-17 21:20:08.864411",
  "name": "pibiMessage-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('pibiMessage', {\n  setup (frm) {\n    if (frm.doc.course && frm.doc.session_type) {\n      frm.set_query(\"recipient_table\", function() {\n        return {\n          \"filters\": [[\"Participant Role\", \"session_type\", \"=\", frm.doc.session_type]]\n        };\n      });\n      frm.set_query(\"device_table\", function() {\n        return {\n          \"filters\": [[\"Device\", \"is_scanner\", \"=\", 0]]\n        };\n      });\n      frm.set_query(\"location_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_location\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"recipient_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_role\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"participant_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_participant\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"device_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_device\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"recipient_item\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_recipient\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n    }\n  },\n  course (frm) {\n    if (frm.doc.course && frm.doc.session_type) {\n      frm.set_query(\"location_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_location\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"recipient_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_role\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"participant_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_participant\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"device_table\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_device\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n      frm.set_query(\"recipient_item\", function() {\n\t    return {\n\t\t  \"query\": \"atvirtual.atvirtual.custom.query_recipient\",\n\t\t  \"txt\": frm.doc.course\n\t    };\n      });\n    }\n  }\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Training Place",
  "modified": "2021-03-12 12:46:55.263222",
  "name": "Training Place-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Training Place', {\n  setup (frm) {\n    // your code here  \n  },    \n  onload(frm) {\n    show_image(frm);\n  },\n  media_library (frm) {\n    show_image(frm);  \n  }\n});\nfunction show_image (frm) {\n  if (frm.doc.media_library) {\n    frappe.call({\n      method: 'atvirtual.atvirtual.custom.get_image',\n        args: {\n\t      slide: frm.doc.media_library\n        },\n        callback: (r) => {\n          //console.log(r.message);\n          if (r.message.length >0) {\n            var rtemplate = \"\";\n            console.log(r.message);\n            for (var j in r.message) {\n              //rtemplate += '<a href=\"' + r.message[j].image + '\" target=\"_blank\"><img style=\"border: 1px solid #4682b4; float: left; margin: 1px; padding: 1px;\" height=\"120px\" src=\"' + r.message[j].image + '\" /></a>';  \n              rtemplate += '<div class=\"card\"><a class=\"card-text\" href=\"' + r.message[j].image + '\" target=\"_blank\"><img style=\"border: 1px solid #4682b4; border-radius: 9px; float: left; margin: 1px; padding: 1px;\" height=\"120px\" title=\"' + r.message[j].heading + '\" src=\"' + r.message[j].image + '\" /></a></div>'; \n            }\n            //var template = '<div class=\"container-fluid\"><h4>' + frm.doc.media_library + '</h4>' + rtemplate + '</div>';\n            var template = '<div class=\"container-fluid\"><h4>' + frm.doc.media_library + '</h4><div class=\"card-columns\">' + rtemplate + '</div></div>';\n            //console.log(template);\n            frm.set_df_property('html_image', 'options', frappe.render_template(template));\n            frm.refresh_field('html_image');\n          }\n        }\n    });    \n  } else {\n    //console.log(frm.doc.media_library);\n    var noimage = '<div class=\"container-fluid\"><h4>Sin Imagenes Disponibles</h4></div>';\n    frm.set_df_property('html_image', 'options', frappe.render_template(noimage));\n    frm.refresh_field('html_image');\n  }\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Standard Message",
  "modified": "2021-05-11 10:23:30.756457",
  "name": "Standard Message-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Standard Message', {\n\trefresh(frm) {\n\t  // your code here\n\t  json_string(frm);\n\t},\n\tstd_message(frm) {\n\t  json_string(frm);    \n\t},\n\ttype(frm) {\n\t  json_string(frm);    \n\t}\n});\nfunction json_string (frm) {\n  var json_message = '';\n  var order = '';\n  if (frm.doc.std_message !== '' && frm.doc.type !== '') {\n    if (frm.doc.order) {\n\t  order = frm.doc.order;\n\t}\n\tjson_message = '{\"type\":\"' + frm.doc.type.toLowerCase() +\n\t  ',\"message\":\"' + frm.doc.std_message.replace(',','') +\n\t  '\"}';\n\t  frm.doc.json_message = json_message;\n    //console.log(json_message);\n  }\n  frm.refresh_field('json_message');\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Device Type",
  "modified": "2021-03-24 22:27:03.270669",
  "name": "Device Type-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Device Type', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tonload(frm) {\n      // your code here\n      show_image(frm);\n    },\n    media_library (frm) {\n      show_image(frm);  \n    }\n});\nfunction show_image (frm) {\n  if (frm.doc.media_library) {\n    frappe.call({\n      method: 'atvirtual.atvirtual.custom.get_image',\n        args: {\n\t      slide: frm.doc.media_library\n        },\n        callback: (r) => {\n          //console.log(r.message);\n          if (r.message.length >0) {\n            var rtemplate = \"\";\n            console.log(r.message);\n            for (var j in r.message) {\n              //rtemplate += '<a href=\"' + r.message[j].image + '\" target=\"_blank\"><img style=\"border: 1px solid #4682b4; float: left; margin: 1px; padding: 1px;\" height=\"120px\" src=\"' + r.message[j].image + '\" /></a>';  \n              rtemplate += '<div class=\"card\"><a class=\"card-text\" href=\"' + r.message[j].image + '\" target=\"_blank\"><img style=\"border: 1px solid #4682b4; border-radius: 9px; float: left; margin: 1px; padding: 1px;\" height=\"120px\" title=\"' + r.message[j].heading + '\" src=\"' + r.message[j].image + '\" /></a></div>'; \n            }\n            //var template = '<div class=\"container-fluid\"><h4>' + frm.doc.media_library + '</h4>' + rtemplate + '</div>';\n            var template = '<div class=\"container-fluid\"><h4>' + frm.doc.media_library + '</h4><div class=\"card-columns\">' + rtemplate + '</div></div>';\n            //console.log(template);\n            frm.set_df_property('html_image', 'options', frappe.render_template(template));\n            frm.refresh_field('html_image');\n          }\n        }\n    });    \n  } else {\n    //console.log(frm.doc.media_library);\n    var noimage = '<div class=\"container-fluid\"><h4>No Image Gallery</h4></div>';\n    frm.set_df_property('html_image', 'options', frappe.render_template(noimage));\n    frm.refresh_field('html_image');\n  }\n}"
 }
]